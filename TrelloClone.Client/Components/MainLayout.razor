@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization

<CascadingAuthenticationState>
    <div class="d-flex flex-column vh-100 overflow-hidden app-container">
        <header class="navbar navbar-expand-lg navbar-light bg-white z-1 app-header">
            <div class="container-fluid">
                <div class="d-flex align-items-center gap-4">
                    <button class="sidebar-toggle" @onclick="ToggleSidebar">
                        <i class="navbar-toggler-icon"></i>
                    </button>
                    <a href="/" class="navbar-brand fs-4 brand-logo p-2">
                        <i class="bi bi-kanban"></i>
                        <span class="d-none d-sm-inline fw-bold">Trello</span>
                    </a>
                </div>
                <div class="d-flex align-items-center gap-4">
                    <AuthorizeView>
                        <Authorized>
                            <Notifications />
                            <div class="d-flex p-2 gap-1 align-items-center justify-content-center fs-4">
                                <a href="/profile" class="d-flex align-items-center p-2 gap-2 user-menu">
                                    <i class="bi bi-person-circle user-avatar"></i>
                                    <div class="fs-6 fw-medium user-name">@context.User.Identity!.Name</div>
                                </a>
                                <button class="fs-6 p-2 p-sm-3 gap-2 logout-btn" @onclick="Logout">
                                    <i class="bi bi-box-arrow-right"></i>
                                    <span class="d-none d-sm-inline">Sign out</span>
                                </button>
                            </div>
                        </Authorized>
                        <NotAuthorized>
                            <div class="auth-buttons">
                                <a href="/login" class="auth-btn btn-light">Log in</a>
                                <a href="/register" class="auth-btn btn-primary">Sign up</a>
                            </div>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>
        </header>
        <div class="d-flex flex-fill overflow-hidden">
            <aside class="overflow-y-auto app-sidebar @(sidebarCollapsed ? "collapsed" : "")">
                <NavMenu />
            </aside>
            <main class="main-content">
                <div class="p-4">
                    @Body
                </div>
            </main>
        </div>
    </div>
</CascadingAuthenticationState>

@code {
    private bool sidebarCollapsed = true;

    [Inject] private IAuthService AuthService { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    private void ToggleSidebar() => sidebarCollapsed = !sidebarCollapsed;

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/");
    }
}