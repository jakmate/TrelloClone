@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization

<CascadingAuthenticationState>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <button class="sidebar-toggle" @onclick="ToggleSidebar">
                    <i class="bi bi-list"></i>
                </button>
                <a href="/" class="brand-logo">
                    <i class="bi bi-kanban"></i>
                    <span class="logo-text">Trello</span>
                </a>
            </div>
            <div class="header-right">
                <Notifications />
                <AuthorizeView>
                    <Authorized>
                        <div class="user-menu">
                            <div class="user-avatar">
                                <a href="/profile">
                                    <i class="bi bi-person"></i>
                                </a>
                            </div>
                            <div class="user-info">
                                <div class="user-name">@context.User.Identity!.Name</div>
                                <button class="logout-btn" @onclick="Logout">
                                    <i class="bi bi-box-arrow-right"></i> Sign out
                                </button>
                            </div>
                        </div>
                    </Authorized>
                    <NotAuthorized>
                        <div class="auth-buttons">
                            <a href="/login" class="auth-btn btn-light">Log in</a>
                            <a href="/register" class="auth-btn btn-primary">Sign up</a>
                        </div>
                    </NotAuthorized>
                </AuthorizeView>
            </div>
        </header>
        <div class="app-body">
            <aside class="app-sidebar @(sidebarCollapsed ? "collapsed" : "")">
                <NavMenu />
            </aside>
            <main class="main-content">
                <div class="content-container">
                    @Body
                </div>
            </main>
        </div>
    </div>
</CascadingAuthenticationState>

@code {
    private bool sidebarCollapsed = true;

    [Inject] private IAuthService AuthService { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    private void ToggleSidebar() => sidebarCollapsed = !sidebarCollapsed;

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/");
    }
}